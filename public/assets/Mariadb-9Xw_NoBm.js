import{bX as K,u as J,r,b as c,A as d,o,c as i,a as s,l as v,i as m,b$ as x,k as w,$ as f,t as b,n as E,F as I,j as N,w as W,f as _,v as B,h as Y}from"./index-CDvfFfFm.js";import{D as Z}from"./download-uIMTx6R1.js";import{T as ee}from"./trash-2-BKYbS0_N.js";const se={class:"p-3 m-2 bg-white border rounded-md"},te={key:0,class:"p-6"},ae=["disabled"],oe={key:1,class:"p-6"},ne={class:"flex items-center mb-3 space-x-4"},re={class:"text-lg"},le={class:"flex items-center mb-3 space-x-4"},ie={class:"text-lg"},ue=["disabled"],de={class:""},ce={class:"overflow-y-auto divide-y divide-gray-200 max-h-52"},me={class:"flex flex-wrap items-center justify-between sm:flex-nowrap"},ge={class:"flex items-center space-x-3"},pe={class:"text-lg font-medium text-gray-900"},ve={class:"flex items-center space-x-3"},fe={class:"text-lg font-medium text-gray-900"},be={class:"flex items-center mt-2 space-x-2 sm:mt-0"},ye=["onClick","disabled"],he={class:"px-4 py-4 border-t border-gray-200 sm:px-6 bg-gray-50"},xe={class:"p-6 pt-0"},we={class:"h-48 p-4 overflow-y-auto font-mono text-sm text-green-400 bg-gray-900 rounded-lg"},ke={key:2,class:"p-6 py-0"},De=["disabled"],Me={key:0,class:"fixed inset-0 z-10 flex items-center justify-center p-4 bg-black bg-opacity-50"},$e={class:"w-full max-w-md p-6 bg-white rounded-lg"},Se={class:"flex items-center px-3 border border-gray-300 rounded-md shadow-sm"},_e={class:"flex items-center justify-end mt-6 space-x-3"},Be=["disabled"],Te={key:0,class:"flex items-center"},Ce={key:1},Ie={__name:"Mariadb",setup(Ae){const T=J(),g=r(0),l=r([]),A=r(""),p=r(""),y=r(!1),k=r(!1),U=r([]),n=r({username:"",password:"",passwordConfirm:"",ip:"%"}),D=r(!1),M=r(!1),$=r(!1),h=r(!1);S(),C();async function S(){localStorage.getItem("installingMariaDB")=="true"&&(y.value=!0),localStorage.getItem("removingMariaDB")=="true"&&(h.value=!0);try{const t=await c.get(`${d.STATUS_MARIADB}`);if(t.success)A.value=t.version,p.value=t.status,g.value=1,localStorage.setItem("installingMariaDB",!1);else switch(t.message){case"notInstall":g.value=0,localStorage.setItem("removingMariaDB",!1);break;case"versionErr":g.value=1,l.value.push(`[${new Date().toLocaleTimeString()}] Lỗi: Không tìm thấy version MariaDB`);break;default:break}}catch(t){console.log(`Mariadb: ${t}`)}}async function V(){y.value=!0,l.value.push(`[${new Date().toLocaleTimeString()}] Quá trình cài đặt có thể mất vài phút.`),localStorage.setItem("installingMariaDB",!0);try{const a=await c.get(`${d.INSTALL_MARIADB}`);a.success&&S(),l.value.push(`[${new Date().toLocaleTimeString()}] ${a.message}`)}catch(a){console.log(`Mariadb: ${a}`)}finally{y.value=!1,localStorage.setItem("installingMariaDB",!1)}}function P(a){let e="";switch(a){case`active
`:e="bg-green-500";break;case`inactive
`:e="bg-gray-500";break;default:e="bg-red-500";break}return e}function q(a){let e="";switch(a){case`active
`:e="Đang chạy";break;case`inactive
`:e="Đã dừng";break;default:e="Đang lỗi";break}return e}async function F(a){k.value=!0;let e=d.START_MARIADB;a==`active
`&&(e=d.STOP_MARIADB);try{const t=await c.get(`${e}`);t.success&&S(),l.value.push(`[${new Date().toLocaleTimeString()}] ${t.message}`)}catch(t){console.log(`Mariadb: ${t}`)}finally{k.value=!1}}async function C(){try{const a=await c.get(`${d.LIST_USER_MARIADB}`);if(a.success){const t=a.message.trim().split(`
`),u=t[0].split("	"),L=t.slice(1).map(O=>{const Q=O.split("	");return u.reduce((R,X,G)=>(R[X]=Q[G],R),{})});U.value=L}}catch(a){console.log(`Mariadb: ${a}`)}}async function j(){if(n.value.password!==n.value.passwordConfirm)return T.warning("Mật khẩu không giống nhau");D.value=!0;try{const a=new FormData;a.append("newUser",`awmvps_${n.value.username}`),a.append("password",n.value.password),a.append("ip",n.value.ip);const e=await c.post(d.CREATE_USER_MARIADB,a);e.success?(C(),T.success("Đã thêm tài khoản thành công"),l.value.push(`[${new Date().toLocaleTimeString()}] Đã thêm tài khoản ${n.value.username}@${n.value.ip}`)):l.value.push(`[${new Date().toLocaleTimeString()}] ${e.message}`)}catch(a){console.log(`Mariadb: ${a}`)}finally{M.value=!1,D.value=!1}}async function H(a,e){$.value=!0;try{const t=new FormData;t.append("newUser",a),t.append("ip",e);const u=await c.post(d.DELETE_USER_MARIADB,t);u.success?(C(),T.success("Đã xoá tài khoản thành công"),l.value.push(`[${new Date().toLocaleTimeString()}] Đã xoá tài khoản ${a}@${e}`)):l.value.push(`[${new Date().toLocaleTimeString()}] ${u.message}`)}catch(t){console.log(`Mariadb: ${t}`)}finally{$.value=!1}}async function z(){h.value=!0,l.value.push(`[${new Date().toLocaleTimeString()}] Quá trình gỡ cài đặt có thể mất vài phút.`),localStorage.setItem("removingMariaDB",!0);try{const a=await c.get(`${d.REMOVE_MARIADB}`);a.success&&S(),l.value.push(`[${new Date().toLocaleTimeString()}] ${a.message}`)}catch(a){console.log(`Mariadb: ${a}`)}finally{h.value=!1,localStorage.setItem("removingMariaDB",!1)}}return(a,e)=>(o(),i(I,null,[s("div",se,[g.value==0?(o(),i("div",te,[e[9]||(e[9]=s("h2",{class:"mb-4 text-2xl font-semibold"},"MariaDB",-1)),e[10]||(e[10]=s("div",{class:"flex items-center space-x-4"},[s("div",{class:"w-4 h-4 bg-gray-500 rounded-full"}),s("span",{class:"text-lg"},"Chưa cài đặt")],-1)),s("button",{onClick:V,class:"mt-4 bg-green-500 btn-action hover:bg-green-600",disabled:y.value},[y.value?(o(),v(m(x),{key:1,class:"w-5 h-5 mr-2 animate-spin"})):(o(),v(m(Z),{key:0,class:"w-5 h-5 mr-2"})),e[8]||(e[8]=w(" Cài đặt "))],8,ae)])):f("",!0),g.value==1?(o(),i("div",oe,[e[13]||(e[13]=s("h2",{class:"mb-4 text-2xl font-semibold"},"MariaDB",-1)),s("div",ne,[s("span",re,b(A.value),1)]),s("div",le,[s("div",{class:E(`w-4 h-4 ${P(p.value)} rounded-full`)},null,2),s("span",ie,b(q(p.value)),1),s("button",{class:E(` btn-action cursor-pointer ${p.value===`active
`?"bg-red-500":"bg-green-500"}`),disabled:k.value,onClick:e[0]||(e[0]=t=>F(p.value))},[k.value?(o(),v(m(x),{key:0,class:"w-5 h-5 mr-2 animate-spin"})):f("",!0),w(" "+b(p.value===`active
`?"Dừng":"Chạy"),1)],10,ue)]),e[14]||(e[14]=s("div",{class:"grid grid-cols-1 gap-4 mb-8 md:grid-cols-4"},null,-1)),s("div",de,[e[12]||(e[12]=s("div",{class:"px-3 py-4 border-b border-gray-200 sm:px-6 bg-gray-50"},[s("h1",{class:"text-xl font-semibold text-gray-900"}," Danh sách người dùng ")],-1)),s("ul",ce,[(o(!0),i(I,null,N(U.value,(t,u)=>(o(),i("li",{key:`Mariadb-users-${u}`,class:"px-4 py-4 transition-colors duration-150 sm:px-6 hover:bg-gray-50"},[s("div",me,[s("div",ge,[s("h2",pe,b(t.User),1)]),s("div",ve,[s("h2",fe,b(t.Host),1)]),s("div",be,[s("button",{onClick:L=>H(t.User,t.Host),class:"px-3 py-1 text-white transition-colors duration-150 bg-red-500 rounded-md hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2",disabled:$.value},[$.value?(o(),v(m(x),{key:0,class:"w-5 h-5 mr-2 animate-spin"})):f("",!0),e[11]||(e[11]=w(" Delete "))],8,ye)])])]))),128))]),s("div",he,[s("button",{onClick:e[1]||(e[1]=t=>M.value=!0),class:"w-full px-4 py-2 text-white transition-colors duration-150 bg-green-500 rounded-md sm:w-auto hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2"}," Thêm người dùng mới ")])])])):f("",!0),s("div",xe,[e[15]||(e[15]=s("h2",{class:"mb-4 text-2xl font-semibold"},"Logs",-1)),s("div",we,[(o(!0),i(I,null,N(l.value,(t,u)=>(o(),i("p",{key:`Mariadb-log-${u}`},b(t),1))),128))])]),g.value==1?(o(),i("div",ke,[s("button",{onClick:e[2]||(e[2]=t=>z()),class:"bg-red-500 btn-action hover:bg-red-600",disabled:h.value},[h.value?(o(),v(m(x),{key:1,class:"w-5 h-5 mr-2 animate-spin"})):(o(),v(m(ee),{key:0,class:"w-5 h-5 mr-2"})),e[16]||(e[16]=w(" Gỡ cài đặt "))],8,De)])):f("",!0)]),M.value?(o(),i("div",Me,[s("div",$e,[e[24]||(e[24]=s("h1",{class:"mb-6 text-2xl font-medium text-gray-900"},"Thêm người dùng",-1)),s("form",{onSubmit:W(j,["prevent"]),class:"space-y-4"},[s("div",null,[e[18]||(e[18]=s("label",{for:"username",class:"block mb-1 text-sm font-medium text-gray-700"}," Tên đăng nhập ",-1)),s("div",Se,[e[17]||(e[17]=s("p",null,"awmvps_",-1)),_(s("input",{type:"text",id:"username","onUpdate:modelValue":e[3]||(e[3]=t=>n.value.username=t),class:"w-full py-2 outline-none",placeholder:"Nhập tên đăng nhập",required:""},null,512),[[B,n.value.username]])])]),s("div",null,[e[19]||(e[19]=s("label",{for:"password",class:"block mb-1 text-sm font-medium text-gray-700"}," Mật khẩu ",-1)),_(s("input",{type:"password",id:"passwordUser","onUpdate:modelValue":e[4]||(e[4]=t=>n.value.password=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm outline-none",placeholder:"Nhập mật khẩu",required:""},null,512),[[B,n.value.password]])]),s("div",null,[e[20]||(e[20]=s("label",{for:"passwordConfirm",class:"block mb-1 text-sm font-medium text-gray-700"}," Nhập lại mật khẩu ",-1)),_(s("input",{type:"password",id:"passwordUserConfirm","onUpdate:modelValue":e[5]||(e[5]=t=>n.value.passwordConfirm=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm outline-none",placeholder:"Nhập lại mật khẩu",required:""},null,512),[[B,n.value.passwordConfirm]])]),s("div",null,[e[21]||(e[21]=s("label",{for:"passwordConfirm",class:"block mb-1 text-sm font-medium text-gray-700"}," IP ",-1)),_(s("input",{type:"text",id:"ip","onUpdate:modelValue":e[6]||(e[6]=t=>n.value.ip=t),class:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm outline-none",placeholder:"Nhập ip",required:""},null,512),[[B,n.value.ip]]),e[22]||(e[22]=s("p",{class:"mt-2 text-sm text-red-500"},"Note: % cho tất cả ip",-1))]),s("div",_e,[s("button",{type:"button",onClick:e[7]||(e[7]=t=>M.value=!1),class:"px-4 py-2 text-sm font-medium text-gray-700 border border-gray-300 rounded-md hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Hủy "),s("button",{type:"submit",class:"px-4 py-2 text-sm font-medium text-white bg-blue-600 border border-transparent rounded-md shadow-sm hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",disabled:D.value},[D.value?(o(),i("span",Te,[Y(m(x),{class:"w-4 h-4 mr-2 -ml-1 animate-spin"}),e[23]||(e[23]=w(" Đang xử lý... "))])):(o(),i("span",Ce,"Xác nhận"))],8,Be)])],32)])])):f("",!0)],64))}},Ee=K(Ie,[["__scopeId","data-v-727ff965"]]);export{Ee as default};
