import{bX as K,r as i,b as c,A as r,o as a,c as g,a as s,l as p,i as x,b$ as S,k as I,$ as _,n as T,t as h,f as F,v as X,F as G,j as E}from"./index-CDvfFfFm.js";import{D as Q}from"./download-uIMTx6R1.js";import{T as z}from"./trash-2-BKYbS0_N.js";const H={class:"p-3 m-2 bg-white border rounded-md"},q={key:0,class:"p-6"},J=["disabled"],W={key:1,class:"p-6"},Y={class:"flex items-center mb-3 space-x-4"},Z={class:"text-lg"},ee=["disabled"],te={class:"overflow-hidden bg-white border rounded-lg shadow-sm"},se={class:"p-4 border-b border-gray-200 sm:p-6"},ne={class:"sm:flex sm:items-center sm:justify-between"},oe={class:"flex-1 min-w-0"},ae={class:"text-2xl font-bold leading-7 text-gray-900 sm:truncate"},le={class:"flex flex-col sm:flex-row"},re={class:"w-full p-4 border-b border-gray-200 sm:w-64 bg-gray-50 sm:p-6 sm:border-b-0 sm:border-r"},ie={class:"space-y-2"},ce=["onClick"],ue={class:"flex-1 p-4 sm:p-6"},ge={class:"mb-4"},de={class:"p-6 pt-0"},me={class:"h-48 p-4 overflow-y-auto font-mono text-sm text-green-400 bg-gray-900 rounded-lg"},fe={key:2,class:"p-6 py-0"},ve=["disabled"],be={__name:"NginxPage",setup(pe){const f=i(0),l=i([]),m=i(""),v=i(!1),N=i(!1),b=i(!1),y=i([]),w=i(""),d=i(""),u=i(y.value[0]);$(),k();async function $(){localStorage.getItem("installingNginx")=="true"&&(v.value=!0),localStorage.getItem("removingNginx")=="true"&&(b.value=!0);try{const n=await c.get(`${r.STATUS_NGINX}`);if(n.success)m.value=n.status,f.value=1,localStorage.setItem("installingNginx",!1);else switch(n.message){case"notInstall":f.value=0,localStorage.setItem("removingNginx",!1);break;default:break}}catch(n){console.log(`Nginx: ${n}`)}}async function O(){v.value=!0,l.value.push(`[${new Date().toLocaleTimeString()}] Quá trình cài đặt có thể mất vài phút.`),localStorage.setItem("installingNginx",!0);try{const t=await c.get(`${r.INSTALL_NGINX}`);t.success&&$(),l.value.push(`[${new Date().toLocaleTimeString()}] ${t.message}`)}catch(t){console.log(`Nginx: ${t}`)}finally{v.value=!1,localStorage.setItem("installingNginx",!1)}}function P(t){let e="";switch(t){case`active
`:e="bg-green-500";break;case`inactive
`:e="bg-gray-500";break;default:e="bg-red-500";break}return e}function V(t){let e="";switch(t){case`active
`:e="Đang chạy";break;case`inactive
`:e="Đã dừng";break;default:e="Đang lỗi";break}return e}async function A(t){N.value=!0;let e=r.START_NGINX;t==`active
`&&(e=r.STOP_NGINX);try{const n=await c.get(`${e}`);n.success&&$(),l.value.push(`[${new Date().toLocaleTimeString()}] ${n.message}`)}catch(n){console.log(`Nginx: ${n}`)}finally{N.value=!1}}async function R(){b.value=!0,l.value.push(`[${new Date().toLocaleTimeString()}] Quá trình gỡ cài đặt có thể mất vài phút.`),localStorage.setItem("removingNginx",!0);try{const t=await c.get(`${r.REMOVE_NGINX}`);t.success&&$(),l.value.push(`[${new Date().toLocaleTimeString()}] ${t.message}`)}catch(t){console.log(`Nginx: ${t}`)}finally{b.value=!1,localStorage.setItem("removingNginx",!1)}}async function k(){try{const t=await c.get(`${r.LIST_CONF_NGINX}`);if(t.success){const e=t.message.trim().split(`
`).map((n,o)=>({id:o+1,name:n}));e.length&&(u.value=e[0],D(e[0])),y.value=e}else t.message==`ls: cannot access '*.conf': No such file or directory
`?(y.value=[],u.value=null,d.value=""):l.value.push(`[${new Date().toLocaleTimeString()}] ${t.message}`)}catch(t){console.log(`Nginx: ${t}`)}}async function D(t){try{const e=new FormData;e.append("fileName",`${t.name}`);const n=await c.post(r.FILE_CONF_NGINX,e);n.success?(u.value=t,d.value=n.message):l.value.push(`[${new Date().toLocaleTimeString()}] ${n.message}`)}catch(e){console.log(`Nginx: ${e}`)}}async function B(){try{const t=new FormData;t.append("fileName",`${w.value}.conf`);const e=await c.post(r.CREATE_CONF_NGINX,t);e.success&&(k(),w.value=""),l.value.push(`[${new Date().toLocaleTimeString()}] ${e.message}`)}catch(t){console.log(`Nginx: ${t}`)}}async function M(){try{if(!u.value.name)return;const t=new FormData;t.append("fileName",`${u.value.name}`);const e=await c.post(r.REMOVE_CONF_NGINX,t);e.success&&k(),l.value.push(`[${new Date().toLocaleTimeString()}] ${e.message}`)}catch(t){console.log(`Nginx: ${t}`)}}async function U(){try{if(!u.value.name||!d.value)return;const t=new FormData;t.append("fileName",`${u.value.name}`),t.append("content",`${d.value.replace(/\$/g,"\\$")}`),console.log(d.value.replace(/\$/g,"\\$"));const e=await c.post(r.SAVE_CONF_NGINX,t);l.value.push(`[${new Date().toLocaleTimeString()}] ${e.message}`)}catch(t){console.log(`Nginx: ${t}`)}}async function j(){try{const t=await c.get(`${r.CHECK_CONF_NGINX}`);l.value.push(`[${new Date().toLocaleTimeString()}] ${t.message}`)}catch(t){console.log(`Nginx: ${t}`)}}return(t,e)=>{var n;return a(),g("div",H,[f.value==0?(a(),g("div",q,[e[5]||(e[5]=s("h2",{class:"mb-4 text-2xl font-semibold"},"Nginx",-1)),e[6]||(e[6]=s("div",{class:"flex items-center space-x-4"},[s("div",{class:"w-4 h-4 bg-gray-500 rounded-full"}),s("span",{class:"text-lg"},"Chưa cài đặt")],-1)),s("button",{onClick:O,class:"mt-4 bg-green-500 btn-action hover:bg-green-600",disabled:v.value},[v.value?(a(),p(x(S),{key:1,class:"w-5 h-5 mr-2 animate-spin"})):(a(),p(x(Q),{key:0,class:"w-5 h-5 mr-2"})),e[4]||(e[4]=I(" Cài đặt "))],8,J)])):_("",!0),f.value==1?(a(),g("div",W,[e[9]||(e[9]=s("h2",{class:"mb-4 text-2xl font-semibold"},"Nginx",-1)),s("div",Y,[s("div",{class:T(`w-4 h-4 ${P(m.value)} rounded-full`)},null,2),s("span",Z,h(V(m.value)),1),s("button",{class:T(` btn-action cursor-pointer ${m.value===`active
`?"bg-red-500":"bg-green-500"}`),disabled:N.value,onClick:e[0]||(e[0]=o=>A(m.value))},[N.value?(a(),p(x(S),{key:0,class:"w-5 h-5 mr-2 animate-spin"})):_("",!0),I(" "+h(m.value===`active
`?"Dừng":"Chạy"),1)],10,ee)]),s("div",te,[s("div",se,[s("div",ne,[s("div",oe,[s("h2",ae,h((n=u.value)==null?void 0:n.name),1)]),s("div",{class:"flex gap-4 mt-4 sm:mt-0 sm:ml-4"},[s("button",{onClick:M,class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-red-500 border border-transparent rounded-md shadow-sm hover:bg-red-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500"}," Xóa file "),s("button",{onClick:U,class:"inline-flex items-center px-4 py-2 text-sm font-medium text-white bg-blue-500 border border-transparent rounded-md shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Lưu file ")])])]),s("div",le,[s("div",re,[e[7]||(e[7]=s("h3",{class:"mb-4 text-lg font-medium text-gray-900"}," Tập tin cấu hình ",-1)),F(s("input",{type:"text","onUpdate:modelValue":e[1]||(e[1]=o=>w.value=o),class:"w-full px-3 py-2 text-sm border border-gray-300 rounded-md shadow-sm outline-none",placeholder:"Nhập tên file"},null,512),[[X,w.value]]),s("button",{onClick:B,class:"flex items-center px-4 py-2 my-4 text-sm font-medium text-white bg-blue-500 border border-transparent rounded-md shadow-sm hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500"}," Tạo file "),s("ul",ie,[(a(!0),g(G,null,E(y.value,(o,C)=>{var L;return a(),g("li",{key:`NginxPage-configs-${C}`,onClick:xe=>D(o),class:T(["p-2 transition-colors duration-150 rounded-md cursor-pointer hover:bg-gray-100",{"bg-blue-100":o.id===((L=u.value)==null?void 0:L.id)}])},h(o.name),11,ce)}),128))])]),s("div",ue,[s("div",ge,[e[8]||(e[8]=s("label",{for:"config-content",class:"block text-sm font-medium text-gray-700"}," Edit Configuration ",-1)),F(s("textarea",{id:"config-content",rows:"20",class:"block w-full mt-1 font-mono border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm","onUpdate:modelValue":e[2]||(e[2]=o=>d.value=o)},null,512),[[X,d.value]])])])])])])):_("",!0),s("div",{class:"p-6 pt-0"},[s("button",{onClick:j,class:"flex items-center px-4 py-2 my-4 font-medium text-white bg-green-500 border border-transparent rounded-md shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500"}," Kiểm tra cấu hình "),e[10]||(e[10]=s("p",{class:"text-gray-600"},"Để cấu hình áp dụng, vui lòng tắt bật Nginx",-1))]),s("div",de,[e[11]||(e[11]=s("h2",{class:"mb-4 text-2xl font-semibold"},"Logs",-1)),s("div",me,[(a(!0),g(G,null,E(l.value,(o,C)=>(a(),g("p",{key:`Nginx-log-${C}`},h(o),1))),128))])]),f.value==1?(a(),g("div",fe,[s("button",{onClick:e[3]||(e[3]=o=>R()),class:"bg-red-500 btn-action hover:bg-red-600",disabled:b.value},[b.value?(a(),p(x(S),{key:1,class:"w-5 h-5 mr-2 animate-spin"})):(a(),p(x(z),{key:0,class:"w-5 h-5 mr-2"})),e[12]||(e[12]=I(" Gỡ cài đặt "))],8,ve)])):_("",!0)])}}},we=K(be,[["__scopeId","data-v-ae78efbd"]]);export{we as default};
